import pandas as pd
import json
import math

def transform(): #load json into dataframe
    with open('data.json', 'r') as jsonFile:
        data = json.load(jsonFile)
        numSubject = len(data)
        df = pd.DataFrame()
        df1 = pd.DataFrame()

        
        for col in data[next(iter(data))][0]: #initialize the columns of the dataframe
            if (col != "timestamp"):
                df[col] = ""
                df1[col] = ""
        
        for i in range(numSubject):           
            for username in data:
                for dict in data[username]:
                    for key, value in dict.items():
                        if ((key == "duration" and value < 1000)):
                                if (math.dist([dict["startX"], dict["startY"]], [dict["endX"], dict["endY"]]) < 10.0):
                                    print(f'duration: {value}, startX: {dict["startX"]}, startY: {dict["startY"]}, endX: {dict["endX"]}, endY: {dict["endY"]}')

def pri():
    import onnx
    from skl2onnx.common.data_types import FloatTensorType

    model = onnx.load('./models/model0.onnx')
    input_name = model.graph.input[0].name
    output_name = model.graph.output[0].name

    print(f'Input name: {input_name}')
    print(f'Output name: {output_name}')
    print(FloatTensorType([None, 54]))
    
    
def testModel():
    import onnx
    import json
    
    js = {
      "duration": 250,
      "startX": 588,
      "startY": 922,
      "endX": 288,
      "endY": 1039,
      "displacement": 322.00775,
      "averageSpeed": 1.3088262,
      "directionOfEndToEndLine": 2.7697365,
      "averageDirectionEnsemble": 2.4628425,
      "AXmax": 0.775832,
      "AXmin": -0.6342922,
      "AXmean": -0.042412307,
      "AXmedian": -0.15666944,
      "AXSD": 0.46305522,
      "AYmax": 5.725918,
      "AYmin": 5.129787,
      "AYmean": 5.395801,
      "AYmedian": 5.409897,
      "AYSD": 0.13731638,
      "AZmax": 8.803126,
      "AZmin": 7.879006,
      "AZmean": 8.285516,
      "AZmedian": 8.284805,
      "AZSD": 0.2522987,
      "GXmax": 0.46081403,
      "GXmin": -0.0052030515,
      "GXmean": 0.22959116,
      "GXmedian": 0.21158685,
      "GXSD": 0.136781,
      "GYmax": 0.31978294,
      "GYmin": -0.020393481,
      "GYmean": 0.14125825,
      "GYmedian": 0.14038914,
      "GYSD": 0.09773045,
      "GZmax": 0.26331663,
      "GZmin": -0.4992646,
      "GZmean": -0.11096407,
      "GZmedian": -0.0930471,
      "GZSD": 0.21478038,
      "MXmax": 19.592148,
      "MXmin": 19.041351,
      "MXmean": 19.292997,
      "MXmedian": 19.341644,
      "MXSD": 0.15429936,
      "MYmax": -17.438272,
      "MYmin": -18.474865,
      "MYmean": -18.13228,
      "MYmedian": -18.290447,
      "MYSD": 0.31597468,
      "MZmax": 1.0709991,
      "MZmin": -2.3483124,
      "MZmean": -0.38220763,
      "MZmedian": -0.12728882,
      "MZSD": 1.0434456
    }
    
    jsFalse = [{
      "duration": 271,
      "startX": 511,
      "startY": 1114,
      "endX": 621,
      "endY": 891,
      "displacement": 248.65437,
      "averageSpeed": 0.9225064,
      "directionOfEndToEndLine": -1.1125443,
      "averageDirectionEnsemble": -0.9602609,
      "AXmax": 0.50051063,
      "AXmin": -0.086043596,
      "AXmean": 0.22377849,
      "AXmedian": 0.22040108,
      "AXSD": 0.158342,
      "AYmax": 7.6435914,
      "AYmin": 7.2533526,
      "AYmean": 7.434853,
      "AYmedian": 7.437699,
      "AYSD": 0.08192988,
      "AZmax": 7.4097624,
      "AZmin": 6.4976106,
      "AZmean": 7.019718,
      "AZmedian": 7.033889,
      "AZSD": 0.18250254,
      "GXmax": 0.039569043,
      "GXmin": -0.085314736,
      "GXmean": -0.016635297,
      "GXmedian": -0.004745921,
      "GXSD": 0.036080793,
      "GYmax": 0.09877324,
      "GYmin": -0.036182433,
      "GYmean": 0.032523543,
      "GYmedian": 0.021788973,
      "GYSD": 0.038905337,
      "GZmax": 0.07102529,
      "GZmin": -0.20204341,
      "GZmean": -0.08037558,
      "GZmedian": -0.08162422,
      "GZSD": 0.07749693,
      "MXmax": 26.287888,
      "MXmin": 25.74527,
      "MXmean": 26.021318,
      "MXmedian": 26.055775,
      "MXSD": 0.16161202,
      "MYmax": -24.07375,
      "MYmin": -24.972422,
      "MYmean": -24.283413,
      "MYmedian": -24.188221,
      "MYSD": 0.2112958,
      "MZmax": -0.26987457,
      "MZmin": -0.55472565,
      "MZmean": -0.39884323,
      "MZmedian": -0.3756218,
      "MZSD": 0.07781665
    },
    {
      "duration": 274,
      "startX": 495,
      "startY": 1188,
      "endX": 569,
      "endY": 1007,
      "displacement": 195.54283,
      "averageSpeed": 0.72354037,
      "directionOfEndToEndLine": -1.1826928,
      "averageDirectionEnsemble": -1.0084696,
      "AXmax": 0.6273979,
      "AXmin": 0.10069615,
      "AXmean": 0.4205008,
      "AXmedian": 0.44784048,
      "AXSD": 0.12277097,
      "AYmax": 7.4209394,
      "AYmin": 7.1480126,
      "AYmean": 7.298733,
      "AYmedian": 7.2904615,
      "AYSD": 0.057186373,
      "AZmax": 7.4145503,
      "AZmin": 6.7250495,
      "AZmean": 7.152313,
      "AZmedian": 7.1559877,
      "AZSD": 0.13936025,
      "GXmax": 0.0045934445,
      "GXmin": -0.004954153,
      "GXmean": -5.8322406e-05,
      "GXmedian": 0.00022693038,
      "GXSD": 0.0026856475,
      "GYmax": 0.004821464,
      "GYmin": -0.004693982,
      "GYmean": 0.00092837436,
      "GYmedian": 0.0021264981,
      "GYSD": 0.0029349406,
      "GZmax": 0.0049385964,
      "GZmin": -0.0035980141,
      "GZmean": 0.00044988818,
      "GZmedian": 0.00043251098,
      "GZSD": 0.002716296,
      "MXmax": 26.5438,
      "MXmin": 26.37938,
      "MXmean": 26.479383,
      "MXmedian": 26.485348,
      "MXSD": 0.040827293,
      "MYmax": -25.2217,
      "MYmin": -25.70932,
      "MYmean": -25.463766,
      "MYmedian": -25.479172,
      "MYSD": 0.12638247,
      "MZmax": -0.9558029,
      "MZmin": -1.3835449,
      "MZmean": -1.1547862,
      "MZmedian": -1.1549377,
      "MZSD": 0.10643315
    },
    {
      "duration": 245,
      "startX": 550,
      "startY": 1050,
      "endX": 545,
      "endY": 1236,
      "displacement": 186.0672,
      "averageSpeed": 0.759994,
      "directionOfEndToEndLine": 1.5976716,
      "averageDirectionEnsemble": 1.3496902,
      "AXmax": 1.2666223,
      "AXmin": 0.37362343,
      "AXmean": 0.8215884,
      "AXmedian": 0.8356844,
      "AXSD": 0.25205484,
      "AYmax": 7.0833716,
      "AYmin": 6.6811633,
      "AYmean": 6.9405313,
      "AYmedian": 6.946908,
      "AYSD": 0.0805717,
      "AZmax": 7.780847,
      "AZmin": 7.342727,
      "AZmean": 7.551016,
      "AZmedian": 7.542635,
      "AZSD": 0.109783284,
      "GXmax": -0.0029249198,
      "GXmin": -0.39965373,
      "GXmean": -0.21156046,
      "GXmedian": -0.19225682,
      "GXSD": 0.128271,
      "GYmax": -0.018737491,
      "GYmin": -0.13188316,
      "GYmean": -0.06741631,
      "GYmedian": -0.057194617,
      "GYSD": 0.034825765,
      "GZmax": 0.30901533,
      "GZmin": -0.11469528,
      "GZmean": 0.07035653,
      "GZmedian": 0.04546188,
      "GZSD": 0.13761371,
      "MXmax": 26.782173,
      "MXmin": 25.762596,
      "MXmean": 26.384298,
      "MXmedian": 26.49868,
      "MXSD": 0.33186063,
      "MYmax": -24.494682,
      "MYmin": -25.63842,
      "MYmean": -25.03917,
      "MYmedian": -25.091644,
      "MYSD": 0.294762,
      "MZmax": -2.7451324,
      "MZmin": -4.5242233,
      "MZmean": -3.9632177,
      "MZmedian": -4.140579,
      "MZSD": 0.5098302
    },
    {
      "duration": 130,
      "startX": 511,
      "startY": 1298,
      "endX": 588,
      "endY": 1010,
      "displacement": 298.11575,
      "averageSpeed": 2.302755,
      "directionOfEndToEndLine": -1.3095458,
      "averageDirectionEnsemble": -1.0316411,
      "AXmax": 1.1780406,
      "AXmin": 0.7231618,
      "AXmean": 0.9540836,
      "AXmedian": 0.9386307,
      "AXSD": 0.12167351,
      "AYmax": 7.243777,
      "AYmin": 6.7673507,
      "AYmean": 7.017469,
      "AYmedian": 7.0283074,
      "AYSD": 0.116181105,
      "AZmax": 8.415283,
      "AZmin": 6.653227,
      "AZmean": 7.446283,
      "AZmedian": 7.6419897,
      "AZSD": 0.6065065,
      "GXmax": 0.0049564973,
      "GXmin": -0.0047819368,
      "GXmean": 4.5938956e-05,
      "GXmedian": 0.00023028255,
      "GXSD": 0.0032334928,
      "GYmax": 0.0044165715,
      "GYmin": -0.0049119345,
      "GYmean": 0.0005958998,
      "GYmedian": 0.0013210756,
      "GYSD": 0.0029960626,
      "GZmax": 0.0040489305,
      "GZmin": -0.0039824075,
      "GZmean": 6.567703e-05,
      "GZmedian": 0.00012286246,
      "GZSD": 0.0027351968,
      "MXmax": 25.839584,
      "MXmin": 25.641884,
      "MXmean": 25.75298,
      "MXmedian": 25.745995,
      "MXSD": 0.05888817,
      "MYmax": -25.036823,
      "MYmin": -25.498379,
      "MYmean": -25.321589,
      "MYmedian": -25.353638,
      "MYSD": 0.114356466,
      "MZmax": -3.9090347,
      "MZmin": -4.060463,
      "MZmean": -3.977478,
      "MZmedian": -3.968193,
      "MZSD": 0.040199663
    },
    {
      "duration": 178,
      "startX": 486.1764,
      "startY": 1161.8531,
      "endX": 549,
      "endY": 1026,
      "displacement": 149.67592,
      "averageSpeed": 0.84315544,
      "directionOfEndToEndLine": -1.1376475,
      "averageDirectionEnsemble": -1.09652,
      "AXmax": 0.54839265,
      "AXmin": -0.019008756,
      "AXmean": 0.34239605,
      "AXmedian": 0.3975644,
      "AXSD": 0.15589426,
      "AYmax": 6.3412013,
      "AYmin": 6.192767,
      "AYmean": 6.269066,
      "AYmedian": 6.266984,
      "AYSD": 0.03903576,
      "AZmax": 8.276425,
      "AZmin": 7.685084,
      "AZmean": 8.005093,
      "AZmedian": 8.037016,
      "AZSD": 0.12881237,
      "GXmax": 0.068632305,
      "GXmin": -0.12274693,
      "GXmean": 0.001700601,
      "GXmedian": 0.001731724,
      "GXSD": 0.048376724,
      "GYmax": 0.11529931,
      "GYmin": -0.003712148,
      "GYmean": 0.04309374,
      "GYmedian": 0.03027258,
      "GYSD": 0.0414915,
      "GZmax": 0.009767987,
      "GZmin": -0.20444201,
      "GZmean": -0.071562365,
      "GZmedian": -0.048979245,
      "GZSD": 0.069291346,
      "MXmax": 26.217506,
      "MXmin": 26.03254,
      "MXmean": 26.128443,
      "MXmedian": 26.126015,
      "MXSD": 0.051745716,
      "MYmax": -24.97249,
      "MYmin": -25.512968,
      "MYmean": -25.183558,
      "MYmedian": -25.22995,
      "MYSD": 0.13324869,
      "MZmax": -3.808998,
      "MZmin": -4.0554886,
      "MZmean": -3.9262059,
      "MZmedian": -3.935379,
      "MZSD": 0.06514986
    },
    {
      "duration": 250,
      "startX": 571,
      "startY": 597,
      "endX": 554,
      "endY": 746,
      "displacement": 149.96666,
      "averageSpeed": 0.600494,
      "directionOfEndToEndLine": 1.684399,
      "averageDirectionEnsemble": 1.4215853,
      "AXmax": 0.5412103,
      "AXmin": -2.0468106,
      "AXmean": -0.84382266,
      "AXmedian": -0.8868696,
      "AXSD": 0.7386671,
      "AYmax": 6.9349375,
      "AYmin": 6.3507776,
      "AYmean": 6.6121564,
      "AYmedian": 6.580611,
      "AYSD": 0.12015167,
      "AZmax": 9.150271,
      "AZmin": 6.547887,
      "AZmean": 7.7257104,
      "AZmedian": 7.7545123,
      "AZSD": 0.7319065,
      "GXmax": 0.19996871,
      "GXmin": -0.62514913,
      "GXmean": -0.1377106,
      "GXmedian": -0.06293714,
      "GXSD": 0.271951,
      "GYmax": 0.30800867,
      "GYmin": -0.7106926,
      "GYmean": -0.12007595,
      "GYmedian": -0.045174085,
      "GYSD": 0.33404994,
      "GZmax": 0.7863308,
      "GZmin": -0.28688213,
      "GZmean": 0.17193049,
      "GZmedian": 0.060130924,
      "GZSD": 0.32244337,
      "MXmax": 31.463562,
      "MXmin": 30.335777,
      "MXmean": 30.814152,
      "MXmedian": 30.735062,
      "MXSD": 0.42478517,
      "MYmax": -19.138079,
      "MYmin": -19.721403,
      "MYmean": -19.461998,
      "MYmedian": -19.51228,
      "MYSD": 0.16627327,
      "MZmax": -2.3065567,
      "MZmin": -4.3501053,
      "MZmean": -3.5248408,
      "MZmedian": -3.7281113,
      "MZSD": 0.73026973
    },
    {
      "duration": 118,
      "startX": 588,
      "startY": 1090,
      "endX": 593,
      "endY": 1137,
      "displacement": 47.26521,
      "averageSpeed": 0.40150446,
      "directionOfEndToEndLine": 1.4648119,
      "averageDirectionEnsemble": 0.81398374,
      "AXmax": 0.8356845,
      "AXmin": 0.29222405,
      "AXmean": 0.46814248,
      "AXmedian": 0.43826407,
      "AXSD": 0.12096737,
      "AYmax": 6.776927,
      "AYmin": 6.5925817,
      "AYmean": 6.680014,
      "AYmedian": 6.672784,
      "AYSD": 0.040722873,
      "AZmax": 8.020257,
      "AZmin": 7.630019,
      "AZmean": 7.817284,
      "AZmedian": 7.833518,
      "AZSD": 0.09764787,
      "GXmax": 0.0038827187,
      "GXmin": -0.004326592,
      "GXmean": 0.00092491106,
      "GXmedian": 0.0020754111,
      "GXSD": 0.002667869,
      "GYmax": 0.0046883053,
      "GYmin": -0.0046285517,
      "GYmean": 0.00022650184,
      "GYmedian": -0.00048034222,
      "GYSD": 0.0023794558,
      "GZmax": 0.0049261893,
      "GZmin": -0.0048193345,
      "GZmean": -0.00037782604,
      "GZmedian": -0.00067301304,
      "GZSD": 0.0027207176,
      "MXmax": 28.016792,
      "MXmin": 27.890503,
      "MXmean": 27.955208,
      "MXmedian": 27.957413,
      "MXSD": 0.03994392,
      "MYmax": -22.992472,
      "MYmin": -23.744925,
      "MYmean": -23.30931,
      "MYmedian": -23.348888,
      "MYSD": 0.24915442,
      "MZmax": -5.7180557,
      "MZmin": -5.845787,
      "MZmean": -5.7836328,
      "MZmedian": -5.7772446,
      "MZSD": 0.038863476
    },
    {
      "duration": 332,
      "startX": 518,
      "startY": 1132,
      "endX": 647,
      "endY": 808,
      "displacement": 348.7363,
      "averageSpeed": 1.0621037,
      "directionOfEndToEndLine": -1.1918874,
      "averageDirectionEnsemble": -0.96414185,
      "AXmax": 0.5244516,
      "AXmin": -0.016614676,
      "AXmean": 0.24394901,
      "AXmedian": 0.23596273,
      "AXSD": 0.09506786,
      "AYmax": 6.949302,
      "AYmin": 6.6883454,
      "AYmean": 6.815375,
      "AYmedian": 6.8152328,
      "AYSD": 0.053081747,
      "AZmax": 8.286002,
      "AZmin": 7.024312,
      "AZmean": 7.551104,
      "AZmedian": 7.536649,
      "AZSD": 0.27727664,
      "GXmax": 0.0041380627,
      "GXmin": -0.0049916566,
      "GXmean": -0.000982299,
      "GXmedian": -0.0013144772,
      "GXSD": 0.0024372274,
      "GYmax": 0.00472529,
      "GYmin": -0.0049463836,
      "GYmean": -8.761094e-05,
      "GYmedian": -0.00074303494,
      "GYSD": 0.0029870349,
      "GZmax": 0.004984602,
      "GZmin": -0.0049933637,
      "GZmean": -0.0002447687,
      "GZmedian": -0.00045092386,
      "GZSD": 0.0028243768,
      "MXmax": 28.316597,
      "MXmin": 27.804703,
      "MXmean": 27.995165,
      "MXmedian": 27.939304,
      "MXSD": 0.14247096,
      "MYmax": -22.64119,
      "MYmin": -23.75012,
      "MYmean": -23.009954,
      "MYmedian": -22.88492,
      "MYSD": 0.29176474,
      "MZmax": -4.3468094,
      "MZmin": -4.6961594,
      "MZmean": -4.534624,
      "MZmedian": -4.5366135,
      "MZSD": 0.08962919
    }]
    
    df = pd.DataFrame()
    df1 = pd.DataFrame()
    for col in jsFalse[0].keys(): #initialize the columns of the dataframe
            if (col != "timestamp"):
                df[col] = ""
                df1[col] = ""
                
    for dict in jsFalse:
        for key, value in dict.items():
            if (key != "timestamp"):
                df1[key] = [value]
        df = pd.concat([df,df1])
        
    from sklearn.preprocessing import MinMaxScaler
    #scaler = MinMaxScaler(feature_range=(0,1)).fit(df)
    #df = scaler.transform(df)
    from skl2onnx.common.data_types import FloatTensorType
    import onnxruntime as rt
    import numpy as np
    from sklearn.metrics import classification_report
    import pickle
    rf = pickle.load(open("./models/rf0.pickle", "rb"))
    y_predicted = rf.predict_proba(df)
    print(y_predicted)
    
    sess = rt.InferenceSession(
            f"./models/model0.onnx", providers=rt.get_available_providers())
    input_name = sess.get_inputs()[0].name
    #print(X_test.astype(np.float32).to_dict('split')['data'])
    #break
    y_pred = sess.run(None, {input_name: df.astype(np.float32).to_dict('split')['data']})
    print(y_pred)
    #print(classification_report())

pd.set_option('display.max_colwidth', None)
pd.set_option('display.max_rows', None)

#testModel()
#pri()

with open('./evaluationData.json', 'r+') as file:
  fileData = json.load(file)
  fileData["222"]["predict_0"] += 1
  print(fileData["222"]["predict_0"])
  file.seek(0)
  json.dump(fileData, file, indent=2)